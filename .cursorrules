# Cursor Rules

**This file:** Adding too much leads to rules being ignored. Only add when needed. Do not change `.cursorrules` without asking the user.

**Prefer local tools over sending data to servers.** When a task can be done locally (e.g. copy a file, search the codebase, transform text), use local execution (copy tool, read+write, grep) rather than sending content to an external service to do the same thing.

## üîÑ Session Continuity

**‚ö†Ô∏è MANDATORY:** ALWAYS run at conversation start (no exceptions):
1. Run `git --no-pager log --stat -5`
2. Run `python cursor-scripts/cursor_usage.py reminder --once`
3. Run `python cursor-scripts/startup_cards.py` for daily digest + quiz
4. Summarize recent work

**Then:**
- User gave specific task ‚Üí Do the task immediately after summary
- User says "resume", "continue" ‚Üí Resume previous work
- Otherwise ‚Üí Ask: "Resume from where we left off, or start something new?"

**No skipping:** These checks surface critical context (recent changes, learning reminders) that affects task execution.

**Self-check:** Run startup checks at conversation start (git log, cursor_usage reminder, startup_cards, summarize).

---

### üîÑ New Chat

**Trigger:** User says "new chat", "start fresh", "clear chat", etc.

**Run:**
```bash
./cursor-scripts/cursor-new-chat.sh
```

This exports the current chat and clears history. User then restarts CLI agent.

---

### üìù Conversation Export

**Trigger (immediate, no confirmation):**
- `/e` - Export conversation

**Run:**
```bash
./cursor-scripts/export-chat.sh
```

**Confirm:** "Exported to `cursor-chats/CURSOR-CLI_YYYY-MM-DD.md`"

---

### üö´ Workspace Boundaries

**DO NOT access files outside workspace without explicit permission.**

Includes: `~/.zshrc`, `~/.config/*`, `~/.ssh/*`, any external path

**Workflow for external files:**
1. Ask: "I need to edit `~/.zshrc`. Can you copy it to `./temp/`?"
2. User copies to `./temp/`
3. AI edits `./temp/<filename>`
4. User copies back, confirms "done"
5. AI cleans up: `rm -rf ./temp/* ./temp/.* 2>/dev/null; true`

**Exception:** Only if user explicitly instructs (e.g., "read my ~/.zshrc")

---

### üî¨ Research Protocol (Multi-Source Grounding)

**Goal:** Ground answers in verifiable sources (codebase, docs, web) rather than relying on training data alone.

**When to trigger:** Any question requiring factual accuracy, technical details, best practices, or current information.

**Mandatory source order:**

| Step | Source | Method | When to Use |
|------|--------|--------|-------------|
| 1 | **Codebase** | Grep/Glob/Read | Always first - check existing code/patterns |
| 2 | **Local Docs** | Read `.md` files | Project-specific guides, READMEs |
| 3 | **Web Search** | `web_search.py` | Queries, discovery, external info |
| 4 | **WebFetch** | `WebFetch` tool | Known URLs, specific doc pages |
| 5 | **Browser** | Browser MCP tools | JS-rendered pages (IDE only) |

**Web tool hierarchy:**
| Tool | Best For | Speed | When to Use |
|------|----------|-------|-------------|
| `web_search.py` | Queries, discovery | Fast | Primary - Gemini + Google grounding |
| `WebFetch` | Specific URLs | Medium | Secondary - direct fetch of known pages |
| Browser MCP | JS pages, interaction | Slow | Fallback (IDE only ‚Äî not available in Cursor CLI) |

**Browser MCP:** Available in **IDE only**. Not available in Cursor CLI ‚Äî use `web_search.py` or WebFetch instead.

**Use Browser MCP when (IDE only):**
- Page requires JavaScript rendering (WebFetch returns incomplete/empty)
- Need to navigate or interact with the page
- Visual verification needed
- Other methods fail or return partial data

**Execution rules:**
- **Run sources in parallel** when independent (e.g., grep codebase + read docs simultaneously)
- **Cite sources** in response (file paths, URLs from web search)
- **Skip steps** only if clearly irrelevant (e.g., skip codebase for "what's the weather")
- **Escalate to browser** only when faster methods fail (IDE; in CLI use WebFetch or web search)

**Example triggers:**
- "How do I use X?" ‚Üí Codebase (existing examples) ‚Üí Docs ‚Üí Web (official docs)
- "What's the best way to Y?" ‚Üí Codebase (current approach) ‚Üí Web (best practices)
- "Is Z still supported?" ‚Üí Web (latest info) ‚Üí Docs (local notes)

**CLI execution:**
```bash
# Codebase search
rg "pattern" --type py

# Web search (grounded)
python cursor-scripts/web_search.py "query"
```

---

### üîí Sensitive Files

**Never read unless explicitly debugging auth:**
- `.env` - API credentials

---

### üìÑ Citing Sources

| Can Cite | Cannot Cite |
|----------|-------------|
| `.py`, `.js`, `.ipynb` (code) | `.cursorrules` |
| `.md`, `.txt` (docs) | `.env`, `.gitignore` |
| `README.md` | `.cursor/` files |

---

## üìö Reference

### Tool Paths

```bash
# Usage tracking (On-Demand counts toward quota; Included does not)
python cursor-scripts/cursor_usage.py import   # Import CSV
python cursor-scripts/cursor_usage.py report   # Usage report
python cursor-scripts/cursor_usage.py quota   # Quota status (On-Demand only)
python cursor-scripts/cursor_usage.py quota --on-demand-reported N  # Web vs CSV (N from Cursor console; authoritative)
python cursor-scripts/cursor_usage.py budget   # Daily budget (On-Demand only)
python cursor-scripts/cursor_usage.py alerts   # Threshold alerts (On-Demand only)
python cursor-scripts/cursor_usage.py reminder # CSV reminder

# Chat export
./cursor-scripts/export-chat.sh

# New chat (export + clear)
./cursor-scripts/cursor-new-chat.sh

# Web search
python cursor-scripts/web_search.py "query"

```

### Learning Tools

**Flashcard System (`review.py`):**
```bash
python cursor-scripts/review.py --today        # Show due cards
python cursor-scripts/review.py --add "Q" "A"  # Add card
python cursor-scripts/review.py --quiz         # Interactive review
python cursor-scripts/review.py --quiz --start # Quiz-through-AI (one Q at a time)
python cursor-scripts/review.py --quiz --start --practice  # Practice: random cards, no SM-2
python cursor-scripts/review.py --stats        # Review statistics
```

**Startup Cards (`startup_cards.py`):**
```bash
python cursor-scripts/startup_cards.py          # Full digest + quiz
python cursor-scripts/startup_cards.py --reveal # Show quiz answer (records as review for real cards)
```

**Data storage:** `cursor-data/flashcards.json`

### Model Selection

**‚ö†Ô∏è BEFORE recommending ANY model:**
1. **Fetch latest benchmarks** ‚Äî don't rely on outdated knowledge
2. **Infer task type** from user's question
3. **Follow the workflow below**

**Workflow:**

1. **Automatically fetch latest benchmarks:**
   ```bash
   python cursor-scripts/get_model_benchmarks.py [task_type]
   ```
   - `task_type`: `coding`, `reasoning`, `writing`, `fast`, or `general`
   - Infer from user's question if not specified

2. **Make recommendation based on:**
   - Latest third-party benchmarks (LMSYS Arena, SWE-bench, HumanEval, etc.)
   - Task requirements (coding, reasoning, speed, cost)
   - Cost considerations (from latest pricing data)
   - User's specific needs

### Git Commits

**‚ö†Ô∏è BEFORE committing, follow `COMMIT-CONVENTIONS.md`:**
- Use tags: `add:`, `update:`, `fix:`, `refactor:`, `style:`, `revert:`
- Format: `<tag>: <description>`
- Date format in filenames: `YYYY-DD-MM`

### Documentation Files

- `COMMIT-CONVENTIONS.md` - Git commit message format
- `cursor-scripts/` - CLI tools and utilities
- `cursor-chats/` - Conversation logs
- `cursor-web-search/` - Web search logs
- `cursor-data/` - Flashcard and learning data

### Adding Project-Specific Rules

To customize for your project, add sections below this line:
- Domain-specific protocols (e.g., API wrappers, testing workflows)
- Project-specific tool paths

---

## üîß Project-Specific Rules

<!-- Add your project-specific rules below -->

